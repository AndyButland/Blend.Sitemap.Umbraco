@model SitemapViewModel
@using Our.Umbraco.Blend.Sitemap;
@{
    Layout = null;
    Context.Response.ContentType = "application/xml";
}
<?xml version="1.0" encoding="utf-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9" xmlns:image="http://www.google.com/schemas/sitemap-image/1.1">
    @if (Model.Pages.Any())
    {
        foreach(var item in Model.Pages)
        {
            DisplayPage(item);
        }
    }
</urlset>
@{
    void DisplayPage(SitemapPage item)
    {
        <url>
            <loc>@item.Url</loc>
            <lastmod>@item.UpdateDate</lastmod>
            <changefreq>@item.ChangeFrequency</changefreq>
            <priority>@item.Priority</priority>
            @{
                DisplayRelatedImages(item.ImageUrls);
            }
        </url>
    }

    void DisplayRelatedImages(List<string> urls)
    {
        if (urls.Any())
        {
            foreach (var url in urls)
            {
                <image:image>
                    <image:loc>@url</image:loc>
                </image:image>
            }
        }
    }
}